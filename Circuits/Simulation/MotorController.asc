Version 4
SHEET 1 2712 2204
WIRE -48 -656 -48 -688
WIRE 912 -656 912 -688
WIRE -1696 -624 -1696 -656
WIRE -1392 -608 -1392 -640
WIRE 1136 -592 1136 -624
WIRE -48 -512 -48 -576
WIRE 112 -512 -48 -512
WIRE 912 -512 912 -576
WIRE 912 -512 752 -512
WIRE 1376 -512 1376 -528
WIRE -1696 -496 -1696 -544
WIRE -1392 -480 -1392 -528
WIRE -48 -480 -48 -512
WIRE 912 -480 912 -512
WIRE 2032 -464 1840 -464
WIRE 2208 -464 2208 -496
WIRE 2208 -464 2032 -464
WIRE 2368 -464 2208 -464
WIRE 2544 -464 2368 -464
WIRE -224 -432 -272 -432
WIRE -112 -432 -144 -432
WIRE 1008 -432 976 -432
WIRE 1136 -432 1136 -512
WIRE 1136 -432 1088 -432
WIRE 1376 -416 1376 -448
WIRE 1424 -416 1376 -416
WIRE 1136 -400 1136 -432
WIRE 1840 -400 1840 -464
WIRE 2544 -400 2544 -464
WIRE -736 -352 -736 -384
WIRE 1232 -352 1200 -352
WIRE 1424 -352 1312 -352
WIRE 2032 -352 2032 -464
WIRE 2368 -352 2368 -464
WIRE -48 -336 -48 -384
WIRE 912 -336 912 -384
WIRE 1792 -320 1776 -320
WIRE 2496 -320 2480 -320
WIRE 1424 -288 1376 -288
WIRE 1136 -256 1136 -304
WIRE 1376 -256 1376 -288
WIRE 2160 -240 2096 -240
WIRE 2320 -240 2224 -240
WIRE -736 -208 -736 -272
WIRE -624 -208 -736 -208
WIRE -736 -176 -736 -208
WIRE 1376 -176 1376 -192
WIRE 1840 -144 1840 -304
WIRE 2032 -144 2032 -288
WIRE 2032 -144 1840 -144
WIRE 2096 -144 2096 -240
WIRE 2096 -144 2032 -144
WIRE 2160 -144 2096 -144
WIRE 2320 -144 2320 -240
WIRE 2320 -144 2240 -144
WIRE 2368 -144 2368 -288
WIRE 2368 -144 2320 -144
WIRE 2544 -144 2544 -304
WIRE 2544 -144 2368 -144
WIRE -912 -128 -960 -128
WIRE -800 -128 -832 -128
WIRE -48 -96 -48 -128
WIRE 912 -96 912 -128
WIRE 1840 -80 1840 -144
WIRE 2544 -80 2544 -144
WIRE 2032 -48 2032 -144
WIRE 2096 -48 2096 -144
WIRE 2160 -48 2096 -48
WIRE 2320 -48 2320 -144
WIRE 2320 -48 2224 -48
WIRE 2368 -48 2368 -144
WIRE -736 -16 -736 -80
WIRE 1792 0 1776 0
WIRE 2496 0 2480 0
WIRE -336 16 -336 0
WIRE 1216 16 1216 -16
WIRE -48 48 -48 -16
WIRE 112 48 -48 48
WIRE 912 48 912 -16
WIRE 912 48 752 48
WIRE 1456 96 1456 80
WIRE -336 112 -336 80
WIRE -336 112 -384 112
WIRE -48 128 -48 48
WIRE -48 128 -112 128
WIRE 32 128 -48 128
WIRE 912 128 912 48
WIRE 912 128 832 128
WIRE 976 128 912 128
WIRE 1840 144 1840 16
WIRE 2032 144 2032 16
WIRE 2032 144 1840 144
WIRE 2208 144 2032 144
WIRE 2368 144 2368 16
WIRE 2368 144 2208 144
WIRE 2544 144 2544 16
WIRE 2544 144 2368 144
WIRE -304 176 -384 176
WIRE -176 176 -224 176
WIRE 128 176 96 176
WIRE 256 176 208 176
WIRE 656 176 608 176
WIRE 768 176 736 176
WIRE 1072 176 1040 176
WIRE 1216 176 1216 96
WIRE 1216 176 1152 176
WIRE 1456 192 1456 160
WIRE 1504 192 1456 192
WIRE 2208 192 2208 144
WIRE 1216 208 1216 176
WIRE -1584 224 -1584 192
WIRE -48 224 -112 224
WIRE 32 224 -48 224
WIRE 912 224 832 224
WIRE 976 224 912 224
WIRE -336 240 -384 240
WIRE 1328 256 1280 256
WIRE 1504 256 1408 256
WIRE -336 272 -336 240
WIRE -48 288 -48 224
WIRE 912 288 912 224
WIRE 1504 320 1456 320
WIRE -336 352 -336 336
WIRE 1216 352 1216 304
WIRE 1456 352 1456 320
WIRE -1584 368 -1584 304
WIRE -1776 432 -1776 400
WIRE 1456 432 1456 416
WIRE -1776 480 -1776 432
WIRE -1776 528 -1776 480
WIRE -1776 560 -1776 528
WIRE -1776 704 -1776 640
FLAG 2208 192 0
FLAG 2480 0 Vfb
FLAG 1776 -320 Vff
FLAG 1776 0 Vbb
FLAG 2480 -320 Vbf
FLAG -1584 368 0
FLAG -1696 -496 0
FLAG -1696 -656 V_Gain
FLAG -1392 -480 0
FLAG -1392 -640 V_Lion
FLAG 2208 -496 V_Lion
FLAG -1584 192 FPGA_PWM
FLAG -736 -384 V_Gain
FLAG -736 -16 0
FLAG -624 -208 PWM_INV
FLAG -272 -432 P1
FLAG -48 -688 V_Gain
FLAG -48 -336 0
FLAG -960 -128 FPGA_PWM
FLAG 112 -512 Vff
FLAG -48 -128 V_Gain
FLAG -48 288 0
FLAG 112 48 Vfb
FLAG -336 0 P1
FLAG -336 352 N1
FLAG 256 176 PWM_INV
FLAG 912 -128 V_Gain
FLAG 912 288 0
FLAG 752 48 Vbb
FLAG 1456 80 P1
FLAG 1456 432 N2
FLAG 608 176 PWM_INV
FLAG 912 -688 V_Gain
FLAG 912 -336 0
FLAG 752 -512 Vbf
FLAG 1136 -624 V_Gain
FLAG 1136 -256 0
FLAG 1376 -528 P1
FLAG 1376 -176 P2
FLAG 1216 -16 V_Gain
FLAG 1216 352 0
FLAG -1776 704 0
FLAG -1776 480 N2
FLAG -1776 528 N1
FLAG -1776 400 P1
FLAG -1776 432 P2
SYMBOL ind 2144 -128 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName LMOTOR
SYMATTR Value 10m
SYMATTR SpiceLine Ipk=173 Rser=0.05 Rpar=4.71 Cpar=0
SYMBOL IRFB7537PBF 1792 -400 R0
SYMATTR InstName F_H
SYMBOL IRFB7537PBF 1792 -80 R0
SYMATTR InstName B_L
SYMBOL IRFB7537PBF 2496 -400 R0
SYMATTR InstName B_H
SYMBOL IRFB7537PBF 2496 -80 R0
SYMATTR InstName F_L
SYMBOL voltage -1584 208 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName VFPGA_FSpeed
SYMATTR Value PULSE(0V 5V 0ms 1us 1us {TP} 0.0005s)
SYMBOL voltage -1696 -640 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName VGain
SYMATTR Value 30V
SYMBOL voltage -1392 -624 R0
SYMATTR InstName V4CLion
SYMATTR Value {VCell*4}
SYMBOL diode 2048 -288 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL diode 2384 -288 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMATTR Value 1N4148
SYMBOL diode 2384 16 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL diode 2048 16 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
SYMATTR Value 1N4148
SYMBOL npn -800 -176 R0
SYMATTR InstName Q1
SYMATTR Value 2N3904
SYMBOL res -928 -144 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 10K
SYMBOL res -752 -368 R0
SYMATTR InstName R2
SYMATTR Value 10K
SYMBOL npn -112 -480 R0
SYMATTR InstName Q2
SYMATTR Value 2N3904
SYMBOL res -240 -416 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R3
SYMATTR Value 10K
SYMBOL res -64 -672 R0
SYMATTR InstName R4
SYMATTR Value 10K
SYMBOL npn -176 128 R0
SYMATTR InstName Q3
SYMATTR Value 2N3904
SYMBOL res -320 192 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R5
SYMATTR Value 10K
SYMBOL res -64 -112 R0
SYMATTR InstName R6
SYMATTR Value 10K
SYMBOL npn 96 128 M0
SYMATTR InstName Q4
SYMATTR Value 2N3904
SYMBOL res 224 160 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 10K
SYMBOL npn 1040 128 M0
SYMATTR InstName Q5
SYMATTR Value 2N3904
SYMBOL res 1424 272 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R16
SYMATTR Value 10K
SYMBOL res 928 -112 M0
SYMATTR InstName R13
SYMATTR Value 10K
SYMBOL npn 768 128 R0
SYMATTR InstName Q6
SYMATTR Value 2N3904
SYMBOL res 640 160 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 10K
SYMBOL npn 976 -480 M0
SYMATTR InstName Q8
SYMATTR Value 2N3904
SYMBOL res 1104 -448 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 10K
SYMBOL res 928 -672 M0
SYMATTR InstName R8
SYMATTR Value 10K
SYMBOL npn 1200 -400 M0
SYMATTR InstName Q9
SYMATTR Value 2N3904
SYMBOL res 1152 -608 M0
SYMATTR InstName R10
SYMATTR Value 10K
SYMBOL res 1328 -336 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R11
SYMATTR Value 10K
SYMBOL res 1168 192 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R14
SYMATTR Value 10K
SYMBOL npn 1280 208 M0
SYMATTR InstName Q7
SYMATTR Value 2N3904
SYMBOL res 1232 0 M0
SYMATTR InstName R15
SYMATTR Value 10K
SYMBOL polcap 2224 -256 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 1200µ
SYMATTR Description Capacitor
SYMATTR Type cap
SYMATTR SpiceLine V=35 Irms=2.18 Rser=0.026 Lser=0 mfg="Nichicon" pn="UPL1V122MRH" type="Al electrolytic"
SYMBOL polcap 2160 -32 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C3
SYMATTR Value 1200µ
SYMATTR Description Capacitor
SYMATTR Type cap
SYMATTR SpiceLine V=35 Irms=2.18 Rser=0.026 Lser=0 mfg="Nichicon" pn="UPL1V122MRH" type="Al electrolytic"
SYMBOL Misc\\jumper 1488 -384 R90
SYMATTR InstName X1
SYMBOL Misc\\jumper 1488 -320 R90
SYMATTR InstName X2
SYMBOL Misc\\jumper 1568 224 R90
SYMATTR InstName X3
SYMBOL Misc\\jumper 1568 288 R90
SYMATTR InstName X4
SYMBOL Misc\\jumper -448 144 R270
SYMATTR InstName X5
SYMBOL Misc\\jumper -448 208 R270
SYMATTR InstName X6
SYMBOL voltage -1776 544 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName VFPGA_CTRL
SYMATTR Value 0V
SYMBOL diode -352 16 R0
SYMATTR InstName D5
SYMATTR Value 1N4148
SYMBOL diode -320 336 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D6
SYMATTR Value 1N4148
SYMBOL diode 1360 -512 R0
SYMATTR InstName D9
SYMATTR Value 1N4148
SYMBOL diode 1392 -192 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D10
SYMATTR Value 1N4148
SYMBOL diode 1472 416 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D7
SYMATTR Value 1N4148
SYMBOL diode 1440 96 R0
SYMATTR InstName D8
SYMATTR Value 1N4148
TEXT -240 696 Left 2 !.tran 1s startup
TEXT -1560 352 Left 2 ;PWM Pulse: PULSE(0V 5V 10ms 1ms 1ms 0.5s 1s)
TEXT -1256 512 Left 2 ;PWM Pulse: PULSE(0V 5V 10ms 1ms 1ms 0.5s 1s)
TEXT -1464 -440 Left 2 !.param VCell=4.2
TEXT -240 744 Left 2 ;{V(Vff)-V(V_Lion)}
TEXT -1728 696 Left 2 ;PWL(0s 0V 39ms 0V 40ms 3.3V 80ms 3.3V)
TEXT -512 616 Left 2 !.step param TP 0.00001 0.0001 0.000001
