Version 4
SHEET 1 1792 2204
WIRE 0 -1088 0 -1120
WIRE 0 -1088 -144 -1088
WIRE 144 -1088 0 -1088
WIRE 144 -1040 144 -1088
WIRE 144 -912 144 -960
WIRE 240 -912 144 -912
WIRE 352 -912 320 -912
WIRE 400 -912 352 -912
WIRE 352 -896 352 -912
WIRE -144 -880 -144 -1088
WIRE 352 -800 352 -816
WIRE 144 -736 144 -912
WIRE 240 -736 144 -736
WIRE 352 -736 320 -736
WIRE 400 -736 352 -736
WIRE 352 -720 352 -736
WIRE 144 -656 144 -736
WIRE -1232 -624 -1232 -656
WIRE 352 -624 352 -640
WIRE -928 -608 -928 -640
WIRE -240 -576 -288 -576
WIRE -144 -576 -144 -800
WIRE -144 -576 -176 -576
WIRE -80 -576 -144 -576
WIRE 48 -576 0 -576
WIRE 96 -576 48 -576
WIRE -144 -512 -144 -576
WIRE -1232 -496 -1232 -544
WIRE 48 -496 48 -576
WIRE -928 -480 -928 -528
WIRE -384 -432 -448 -432
WIRE -256 -432 -304 -432
WIRE -192 -432 -256 -432
WIRE -256 -416 -256 -432
WIRE -256 -320 -256 -336
WIRE -144 -320 -144 -416
WIRE -144 -320 -256 -320
WIRE -96 -320 -144 -320
WIRE 48 -320 48 -416
WIRE 48 -320 -96 -320
WIRE 144 -320 144 -560
WIRE 144 -320 48 -320
WIRE -96 -256 -96 -320
WIRE 976 -192 784 -192
WIRE 1152 -192 1152 -224
WIRE 1152 -192 976 -192
WIRE 1312 -192 1152 -192
WIRE 1488 -192 1312 -192
WIRE 784 -128 784 -192
WIRE 1488 -128 1488 -192
WIRE 976 -80 976 -192
WIRE 1312 -80 1312 -192
WIRE 736 -48 720 -48
WIRE 1440 -48 1424 -48
WIRE -1280 32 -1280 0
WIRE 784 128 784 -32
WIRE 976 128 976 -16
WIRE 976 128 784 128
WIRE 1104 128 976 128
WIRE 1312 128 1312 -16
WIRE 1312 128 1184 128
WIRE 1488 128 1488 -32
WIRE 1488 128 1312 128
WIRE -1280 176 -1280 112
WIRE 784 192 784 128
WIRE 1488 192 1488 128
WIRE 976 224 976 128
WIRE 1312 224 1312 128
WIRE 736 272 720 272
WIRE 1440 272 1424 272
WIRE 784 416 784 288
WIRE 976 416 976 288
WIRE 976 416 784 416
WIRE 1152 416 976 416
WIRE 1312 416 1312 288
WIRE 1312 416 1152 416
WIRE 1488 416 1488 288
WIRE 1488 416 1312 416
WIRE -1280 448 -1280 416
WIRE 1152 464 1152 416
WIRE -1280 592 -1280 528
WIRE 192 1056 192 1024
WIRE -768 1072 -768 1040
WIRE -1520 1104 -1520 1072
WIRE 416 1120 416 1088
WIRE 80 1200 32 1200
WIRE 192 1200 192 1136
WIRE 192 1200 160 1200
WIRE -768 1216 -768 1152
WIRE -736 1216 -768 1216
WIRE -608 1216 -656 1216
WIRE 192 1232 192 1200
WIRE -1520 1248 -1520 1184
WIRE -1408 1248 -1520 1248
WIRE -768 1248 -768 1216
WIRE -1520 1280 -1520 1248
WIRE 288 1280 256 1280
WIRE 416 1280 416 1200
WIRE 416 1280 368 1280
WIRE -944 1296 -992 1296
WIRE -832 1296 -864 1296
WIRE 656 1296 656 1248
WIRE 704 1296 656 1296
WIRE 416 1312 416 1280
WIRE -1696 1328 -1744 1328
WIRE -1584 1328 -1616 1328
WIRE 512 1360 480 1360
WIRE 704 1360 592 1360
WIRE 192 1376 192 1328
WIRE -768 1392 -768 1344
WIRE 704 1424 656 1424
WIRE -1520 1440 -1520 1376
WIRE 416 1456 416 1408
WIRE 656 1472 656 1424
WIRE -768 1632 -768 1600
WIRE 192 1632 192 1600
WIRE 496 1744 496 1712
WIRE -768 1776 -768 1712
WIRE -736 1776 -768 1776
WIRE -608 1776 -656 1776
WIRE 80 1776 32 1776
WIRE 192 1776 192 1712
WIRE 192 1776 160 1776
WIRE -1056 1840 -1056 1792
WIRE -1056 1840 -1104 1840
WIRE -768 1856 -768 1776
WIRE -768 1856 -832 1856
WIRE -688 1856 -768 1856
WIRE 192 1856 192 1776
WIRE 192 1856 112 1856
WIRE 256 1856 192 1856
WIRE -1008 1904 -1104 1904
WIRE -896 1904 -928 1904
WIRE -592 1904 -624 1904
WIRE -464 1904 -512 1904
WIRE -64 1904 -112 1904
WIRE 48 1904 16 1904
WIRE 368 1904 320 1904
WIRE 496 1904 496 1824
WIRE 496 1904 448 1904
WIRE 736 1920 736 1872
WIRE 784 1920 736 1920
WIRE 496 1936 496 1904
WIRE -768 1952 -832 1952
WIRE -688 1952 -768 1952
WIRE 192 1952 112 1952
WIRE 256 1952 192 1952
WIRE -1056 1968 -1104 1968
WIRE 608 1984 560 1984
WIRE 784 1984 688 1984
WIRE -1056 2016 -1056 1968
WIRE -768 2016 -768 1952
WIRE 192 2016 192 1952
WIRE 784 2048 736 2048
WIRE 496 2080 496 2032
WIRE 736 2096 736 2048
FLAG 1152 464 0
FLAG 1424 272 Vfb
FLAG 720 -48 Vff
FLAG 720 272 Vbb
FLAG 1424 -48 Vbf
FLAG -1280 592 0
FLAG -1232 -496 0
FLAG -1232 -656 V_Gain
FLAG -928 -480 0
FLAG -928 -640 V_Lion
FLAG 1152 -224 V_Lion
FLAG 352 -624 0
FLAG -448 -432 FPGA_OUT1
FLAG -1280 416 FPGA_PWM
FLAG -1280 176 0
FLAG -1280 0 FPGA_DIGITAL
FLAG 352 -800 0
FLAG 0 -1120 V_Gain
FLAG -96 -256 0
FLAG -288 -576 0
FLAG -1520 1072 V_Gain
FLAG -1520 1440 0
FLAG -1408 1248 PWM_INV
FLAG -992 1296 P1
FLAG -768 1040 V_Gain
FLAG -768 1392 0
FLAG -1744 1328 FPGA_PWM
FLAG -608 1216 Vff
FLAG -768 1600 V_Gain
FLAG -768 2016 0
FLAG -608 1776 Vbb
FLAG -1056 1792 P1
FLAG -1056 2016 N1
FLAG -464 1904 PWM_INV
FLAG 192 1600 V_Gain
FLAG 192 2016 0
FLAG 32 1776 Vfb
FLAG 736 1872 P1
FLAG 736 2096 N2
FLAG -112 1904 PWM_INV
FLAG 192 1024 V_Gain
FLAG 192 1376 0
FLAG 32 1200 Vbf
FLAG 416 1088 V_Gain
FLAG 416 1456 0
FLAG 656 1248 P1
FLAG 656 1472 P2
FLAG 496 1712 V_Gain
FLAG 496 2080 0
SYMBOL ind 1088 144 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 10m
SYMATTR SpiceLine Ipk=173 Rser=0.1 Rpar=4.71 Cpar=0
SYMBOL IRFB7537PBF 736 -128 R0
SYMATTR InstName F_H
SYMBOL IRFB7537PBF 736 192 R0
SYMATTR InstName B_L
SYMBOL IRFB7537PBF 1440 -128 R0
SYMATTR InstName B_H
SYMBOL IRFB7537PBF 1440 192 R0
SYMATTR InstName F_L
SYMBOL voltage -1280 432 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName VFPGA_FSpeed
SYMATTR Value PULSE(0V 5V 0ms 0.001ms 0.001ms 0.1ms 0.2ms)
SYMBOL voltage -1232 -640 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName VGain
SYMATTR Value 30V
SYMBOL voltage -928 -624 R0
SYMATTR InstName V4CLion
SYMATTR Value {VCell*4}
SYMBOL res 336 -736 R0
SYMATTR InstName R11
SYMATTR Value 9.9K
SYMBOL res 224 -720 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R12
SYMATTR Value 0.1K
SYMBOL voltage -1280 16 R0
SYMATTR InstName VFPGA_DIR
SYMATTR Value 0V
SYMBOL res 336 -912 R0
SYMATTR InstName R17
SYMATTR Value 5K
SYMBOL res 224 -896 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R18
SYMATTR Value 5K
SYMBOL res -400 -416 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R1
SYMATTR Value 1K
SYMBOL res -272 -432 R0
SYMATTR InstName R2
SYMATTR Value 9K
SYMBOL RK7002BM -192 -512 R0
SYMATTR InstName U1
SYMBOL res -160 -896 R0
SYMATTR InstName R3
SYMATTR Value 5K
SYMBOL RK7002BM 96 -656 R0
SYMATTR InstName U2
SYMBOL res 128 -1056 R0
SYMATTR InstName R4
SYMATTR Value 1K
SYMBOL cap -176 -592 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value 0.01µF
SYMBOL res -96 -560 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R6
SYMATTR Value 3.5K
SYMBOL res 32 -512 R0
SYMATTR InstName R7
SYMATTR Value 1.5K
SYMBOL diode 992 -16 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL diode 1328 -16 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMATTR Value 1N4148
SYMBOL diode 1328 288 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL diode 992 288 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
SYMATTR Value 1N4148
SYMBOL npn -1584 1280 R0
SYMATTR InstName Q1
SYMATTR Value 2N2222
SYMBOL res -1600 1312 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 33K
SYMBOL res -1536 1088 R0
SYMATTR InstName R8
SYMATTR Value 4.7K
SYMBOL npn -832 1248 R0
SYMATTR InstName Q2
SYMATTR Value 2N2222
SYMBOL res -848 1280 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 33K
SYMBOL res -784 1056 R0
SYMATTR InstName R10
SYMATTR Value 4.7K
SYMBOL res -640 1200 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 33K
SYMBOL npn -896 1856 R0
SYMATTR InstName Q3
SYMATTR Value 2N2222
SYMBOL res -912 1888 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 33K
SYMBOL res -784 1616 R0
SYMATTR InstName R15
SYMATTR Value 4.7K
SYMBOL res -640 1760 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 33K
SYMBOL Misc\\jumper -1040 1872 R90
SYMATTR InstName X1
SYMBOL Misc\\jumper -1040 1936 R90
SYMATTR InstName X2
SYMBOL npn -624 1856 M0
SYMATTR InstName Q4
SYMATTR Value 2N2222
SYMBOL res -496 1888 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R19
SYMATTR Value 33K
SYMBOL npn 320 1856 M0
SYMATTR InstName Q5
SYMATTR Value 2N2222
SYMBOL res 592 1968 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R20
SYMATTR Value 33K
SYMBOL res 208 1616 M0
SYMATTR InstName R21
SYMATTR Value 4.7K
SYMBOL res 64 1760 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R22
SYMATTR Value 56K
SYMBOL Misc\\jumper 720 1952 M90
SYMATTR InstName X3
SYMBOL Misc\\jumper 720 2016 M90
SYMATTR InstName X4
SYMBOL npn 48 1856 R0
SYMATTR InstName Q6
SYMATTR Value 2N2222
SYMBOL res -80 1888 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R23
SYMATTR Value 33K
SYMBOL npn 256 1232 M0
SYMATTR InstName Q7
SYMATTR Value 2N2222
SYMBOL res 272 1264 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R24
SYMATTR Value 33K
SYMBOL res 208 1040 M0
SYMATTR InstName R25
SYMATTR Value 4.7K
SYMBOL res 64 1184 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R26
SYMATTR Value 33K
SYMBOL npn 480 1312 M0
SYMATTR InstName Q8
SYMATTR Value 2N2222
SYMBOL res 432 1104 M0
SYMATTR InstName R27
SYMATTR Value 4.7K
SYMBOL res 496 1344 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R28
SYMATTR Value 33K
SYMBOL Misc\\jumper 640 1328 M90
SYMATTR InstName X5
SYMBOL Misc\\jumper 640 1392 M90
SYMATTR InstName X6
SYMBOL res 352 1888 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R29
SYMATTR Value 33K
SYMBOL npn 560 1936 M0
SYMATTR InstName Q9
SYMATTR Value 2N2222
SYMBOL res 512 1728 M0
SYMATTR InstName R30
SYMATTR Value 4.7K
TEXT -240 696 Left 2 !.tran 10ms startup
TEXT -1256 576 Left 2 ;PWM Pulse: PULSE(0V 5V 10ms 1ms 1ms 0.5s 1s)
TEXT -1256 160 Left 2 ;PWM Pulse: PULSE(0V 5V 10ms 1ms 1ms 0.5s 1s)
TEXT -1352 -440 Left 2 ;25-28V for Op Amp Supply
TEXT -1000 -440 Left 2 !.param VCell=4.2
TEXT 520 -720 Left 2 ;{V(Vff)-V(V_Lion)}
TEXT -664 648 Left 2 !;step param TD list 0.01ms 0.02ms 0.04ms 0.05ms 0.07ms 0.08ms 0.09ms 0.1ms 0.11ms 0.13ms 0.15ms 0.2ms
TEXT 0 592 Left 2 ;0.09ms 0.1ms 0.11ms 0.13ms 0.15ms 0.2ms
