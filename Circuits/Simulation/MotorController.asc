Version 4
SHEET 1 2712 2204
WIRE 848 -1600 848 -1632
WIRE 848 -1456 848 -1520
WIRE 896 -1456 848 -1456
WIRE 1040 -1456 976 -1456
WIRE 848 -1424 848 -1456
WIRE 784 -1376 704 -1376
WIRE 288 -1360 288 -1392
WIRE 848 -1280 848 -1328
WIRE 288 -1200 288 -1280
WIRE 416 -1200 288 -1200
WIRE 288 -1168 288 -1200
WIRE -32 -1120 -64 -1120
WIRE 80 -1120 32 -1120
WIRE 208 -1120 160 -1120
WIRE 224 -1120 208 -1120
WIRE 848 -1088 848 -1120
WIRE 288 -1024 288 -1072
WIRE 848 -944 848 -1008
WIRE 896 -944 848 -944
WIRE 1040 -944 976 -944
WIRE 208 -928 208 -1120
WIRE 288 -928 208 -928
WIRE 848 -912 848 -944
WIRE 784 -864 704 -864
WIRE 848 -768 848 -816
WIRE 224 -608 112 -608
WIRE 432 -608 432 -688
WIRE 432 -608 304 -608
WIRE 544 -608 432 -608
WIRE 752 -608 624 -608
WIRE 432 -384 432 -432
WIRE -1568 -352 -1568 -384
WIRE -1152 -352 -1152 -384
WIRE -992 -352 -992 -384
WIRE 112 -336 112 -608
WIRE 112 -336 32 -336
WIRE 320 -336 112 -336
WIRE 752 -336 752 -608
WIRE 752 -336 544 -336
WIRE 832 -336 752 -336
WIRE -1568 -224 -1568 -272
WIRE -1152 -224 -1152 -272
WIRE -992 -224 -992 -272
WIRE 320 -224 160 -224
WIRE 688 -224 544 -224
WIRE -64 -32 -64 -64
WIRE 960 -32 960 -64
WIRE 160 -16 160 -224
WIRE 240 -16 160 -16
WIRE 432 -16 432 -176
WIRE 432 -16 320 -16
WIRE 528 -16 432 -16
WIRE 688 -16 688 -224
WIRE 688 -16 608 -16
WIRE 432 64 432 -16
WIRE 688 112 688 -16
WIRE 960 112 960 48
WIRE 960 112 688 112
WIRE -64 128 -64 48
WIRE 160 128 160 -16
WIRE 160 128 -64 128
WIRE -64 192 -64 128
WIRE -64 192 -128 192
WIRE 0 192 -64 192
WIRE 960 192 960 112
WIRE 960 192 896 192
WIRE 1024 192 960 192
WIRE -2272 208 -2272 160
WIRE -1584 224 -1584 192
WIRE -192 240 -272 240
WIRE 112 240 64 240
WIRE 432 240 192 240
WIRE 704 240 432 240
WIRE 832 240 784 240
WIRE 1152 240 1088 240
WIRE -64 288 -128 288
WIRE 0 288 -64 288
WIRE 960 288 896 288
WIRE 1024 288 960 288
WIRE -2272 352 -2272 288
WIRE -64 352 -64 288
WIRE 960 352 960 288
WIRE -1584 368 -1584 304
WIRE 288 480 256 480
WIRE 432 480 432 240
WIRE 432 480 368 480
WIRE 464 480 432 480
WIRE 624 480 560 480
WIRE 512 576 512 544
WIRE 512 704 512 656
FLAG -1584 368 0
FLAG -1568 -224 0
FLAG -1568 -384 V_Lion
FLAG -1584 192 FPGA_PWM
FLAG 624 480 0
FLAG 512 704 FPGA_PWM
FLAG 960 352 0
FLAG -64 352 0
FLAG -2272 352 0
FLAG 432 -432 V_Lion
FLAG 432 64 0
FLAG -1152 -224 0
FLAG -1152 -384 V_Gain
FLAG -992 -224 0
FLAG -992 -384 V_SW
FLAG -64 -64 V_Gain
FLAG 960 -64 V_Gain
FLAG 432 -688 0
FLAG -2272 160 Dir
FLAG 288 -1024 0
FLAG 288 -1392 V_SW
FLAG 256 480 V_SW
FLAG -64 -1120 Dir
FLAG 416 -1200 FB
FLAG 32 -336 FF
FLAG 1152 240 FB
FLAG 288 -928 BB
FLAG -272 240 BB
FLAG 832 -336 BF
FLAG 848 -1632 V_Gain
FLAG 848 -1280 0
FLAG 1040 -1456 FF
FLAG 848 -1120 V_Gain
FLAG 848 -768 0
FLAG 1040 -944 BF
FLAG 704 -864 BB
FLAG 704 -1376 FB
SYMBOL voltage -1584 208 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName VFPGA_FSpeed
SYMATTR Value PULSE(0V 5V 0ms 1us 1us {TP} 1ms)
SYMBOL voltage -1568 -368 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V4CLion
SYMATTR Value {VCell*4}
SYMBOL npn 464 544 R270
SYMATTR InstName Q1
SYMATTR Value 2N3904
SYMBOL res 496 672 M180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R1
SYMATTR Value 10K
SYMBOL res 272 496 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R2
SYMATTR Value 10K
SYMBOL npn 1088 192 M0
SYMATTR InstName Q3
SYMATTR Value 2N3904
SYMBOL res 976 -48 M0
SYMATTR InstName R6
SYMATTR Value 10K
SYMBOL npn 832 192 R0
SYMATTR InstName Q4
SYMATTR Value 2N3904
SYMBOL res 688 224 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 10K
SYMBOL npn -192 192 R0
SYMATTR InstName Q5
SYMATTR Value 2N3904
SYMBOL res -80 -48 R0
SYMATTR InstName R13
SYMATTR Value 10K
SYMBOL npn 64 192 M0
SYMATTR InstName Q6
SYMATTR Value 2N3904
SYMBOL res 208 224 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 10K
SYMBOL voltage -2272 192 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName VFPGA_CTRL
SYMATTR Value PWL(0s 5V 1s 5V 1.0001s 0V 2s 0V)
SYMBOL NMOSFullBridge 432 -272 R0
SYMATTR InstName X9
SYMBOL voltage -1152 -368 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName Vg
SYMATTR Value 22V
SYMBOL voltage -992 -368 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName VSW
SYMATTR Value 5V
SYMBOL res 224 0 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R17
SYMATTR Value 10K
SYMBOL res 624 -32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R18
SYMATTR Value 10K
SYMBOL res 640 -624 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R19
SYMATTR Value 1Meg
SYMBOL res 208 -592 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R20
SYMATTR Value 1Meg
SYMBOL npn 224 -1168 R0
SYMATTR InstName Q11
SYMATTR Value 2N3904
SYMBOL res 272 -1376 R0
SYMATTR InstName R23
SYMATTR Value 10K
SYMBOL res 64 -1104 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R24
SYMATTR Value 10K
SYMBOL diode -32 -1136 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL npn 784 -1424 R0
SYMATTR InstName Q7
SYMATTR Value 2N3904
SYMBOL res 832 -1616 R0
SYMATTR InstName R5
SYMATTR Value 10K
SYMBOL npn 784 -912 R0
SYMATTR InstName Q8
SYMATTR Value 2N3904
SYMBOL res 832 -1104 R0
SYMATTR InstName R8
SYMATTR Value 10K
SYMBOL res 880 -960 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 10K
SYMBOL res 880 -1472 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 10K
TEXT -1328 1096 Left 2 !.tran 0 2s
TEXT -1560 352 Left 2 ;PWM Pulse: PULSE(0V 5V 10ms 1ms 1ms 0.5s 1s)
TEXT -1640 -184 Left 2 !.param VCell=4.2
TEXT -1432 968 Left 2 !;step param TP 0.0001 0.0005 0.0001
TEXT -1320 928 Left 2 !.PARAM TP=1ms
TEXT -2560 448 Left 2 ;Requires 5V. If 3.3V support needed, put another inverter stage to step-up using 5V switch rail.
TEXT -2432 416 Left 2 ;Need to shutdown PWM for at least 10ms prior to flipping direction
